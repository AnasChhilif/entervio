#!/bin/bash

COMMIT_MSG_FILE=$1
COMMIT_SOURCE=$2

# Only add issue number if it's a regular commit (not merge, amend, etc.)
if [ -z "$COMMIT_SOURCE" ]; then
    # Extract issue number from branch name (e.g., feature/123-add-auth -> 123)
    BRANCH_NAME=$(git symbolic-ref --short HEAD 2>/dev/null)
    ISSUE_NUMBER=$(echo "$BRANCH_NAME" | grep -oE '[0-9]+' | head -1)

    if [ -n "$ISSUE_NUMBER" ]; then
        # Get the current commit message
        COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

        # Check if issue number is already in the message
        if ! echo "$COMMIT_MSG" | grep -qE "^#$ISSUE_NUMBER"; then
            # Prepend issue number to commit message
            echo "#$ISSUE_NUMBER $COMMIT_MSG" > "$COMMIT_MSG_FILE"
        fi
    fi
fi
